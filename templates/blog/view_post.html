{% extends 'blog.html' %}
{% load staticfiles %}
{% block title %}{{post}}{% endblock %}
{% block address %}
    <li><a href="/blog/">Posts</a></li>
    <li><a href="/blog/view_post/{{post.id}}" title="{{post.title}}">{{post.title | truncatechars:"45"}}</a></li>
{% endblock %}

{% block style %}
            img { 
                width:100%; 
            }
        
{% endblock %}
{% block scripts %}
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
        <script type="text/javascript">
            $(document).ready(function(){
                $("edit_comment_block").hide()
                {% if post_data.like == 1 %}
                    $("#like").hide()
                {% else %}
                    $("#unlike").hide()
                {% endif %}

                {% if post_data.star == 1 %}
                    $("#star").hide()
                {% else %}
                    $("#unstar").hide()
                {% endif %}

                $('#unlike').click(function(){
                    var postid;
                    postid = $(this).attr("data-postid");
                    $.get('/blog/unlike_post/', {postid: postid}, function(data){
                        $("#unlike").hide();
                        $("#like").show();        
                        $("#likep").text(data);
                        
                    });
                });

                $('#like').click(function(){
                    var postid;
                    postid = $(this).attr("data-postid");
                    $.get('/blog/like_post/', {postid: postid}, function(data){
                        $("#unlike").show();
                        $("#unlikep").text(data);
                        $("#like").hide();
                    });
                });

                $('#unstar').click(function(){
                    var postid;
                    postid = $(this).attr("data-postid");
                    $.get('/blog/unstar_post/', {postid: postid}, function(data){
                        $("#unstar").hide();
                        $("#star").show();        
                        $("#starp").text(data);
                        
                    });
                });

                $('#star').click(function(){
                    var postid;
                    postid = $(this).attr("data-postid");
                    $.get('/blog/star_post/', {postid: postid}, function(data){
                        $("#star").hide();
                        $("#unstar").show();        
                        $("#unstarp").text(data);
                        
                    });
                });

                
                $("#addcomment").click(function() {
                    var comment = $('#comment').val();
                    var postid= {{post.id}};
                    if(!comment | $.trim( $('#comment').val() ) == '' ){
                        alert('Enter valid comment');
                    }
                    else{
                        $.get('/blog/post_comment/', {comment:comment, postid: postid}, function(data){
                            $("#commenttext").prepend('<li class="media" id="comment'+data.newid+'"><a class="pull-left" href="/blog/user_profile/{{user.id}}">{% if profile.profile_picture %}<img class="media-object img-text" src="/media/{{profile.profile_picture}}" style="width:70px; height:70px; " alt="{{user.username}}" width="64">{% else %}<img class="media-object img-text" src="/media/user/no-image.jpg" style="width:70px; height:70px; " alt="{{user.username}}" width="64">{% endif %}</a><div class="media-body"><h4 class="media-heading"><a href="/blog/user_profile/{{user.id}}">{% if user.first_name or user.last_name %}{{user.first_name}} {{user.last_name}}{% else %} {{user.username}}{%endif%}</a> <a class="show-comments" onClick="editcommentbutton('+data.newid+')" style="font-size:12px; display:inline;">(Edit)</a><li class="xn-icon-button pull-right"><a onClick="deletecomment('+data.newid+')" title="Remove Comment"><span class="fa fa-remove"></a></span></h4><p style="word-break:break-all;">'+data.comment+'</p><br><br><div class="form-group"><div class="col-md-2 col-sm-2 col-xs-4">{% if profile.profile_picture %}<img alt="{{user.username}}" class="img UFIActorImage _54ru img pull-left" src="/media/{{profile.profile_picture}}" style="width:50px; height:50px;" width="64" >{% else %}<img alt="{{user.username}}" class="img UFIActorImage _54ru img pull-left" src="/media/user/no-image.jpg" style="width:50px; height:50px;" width="64" >{% endif %}</div><div class="col-md-10 col-sm-6 col-xs-8"><textarea class="form-control" rows="1" placeholder="Add Reply" value="{{reply}}" id="reply'+data.newid+'" name="reply" required></textarea></div><div class="col-md-2 col-sm-4 col-xs-12"><button class="btn btn-info btn-xs" id="addreply" onClick="addreply('+data.newid+')"><span class="fa fa-reply">Reply</span></button></div></div><br><br><br><div id="showreply'+data.newid+'"></div></div></li>');
                            $("#comment").val("");
                        });
                    }
                });
                
                $(".editcomment").click(function() {
                    var commentid=$(this).attr("data-commentid");
                    var newcomment = $('#editedcomment'+commentid).val();
                    if(!newcomment | $.trim( $('#editedcomment'+commentid).val() ) == '' ){
                        alert('Enter valid comment');
                    }
                    else{
                        $.get('/blog/edit_comment/', {newcomment:newcomment, commentid:commentid}, function(data){
                            $("#comment_data"+data.newid).text(data.comment);
                            $("#comment_created_on"+data.newid).text(data.created_on);
                              
                        });
                        $("#comment_data"+commentid).show();
                        $("#comment_created_on"+commentid).show();
                        $("#editcommentblock"+commentid).hide();
                    }
                });

                $(".canceleditcomment").click(function() {
                    commentid = $(this).attr("data-commentid");
                    $("#comment_data"+commentid).show();
                    $("#comment_created_on"+commentid).show();
                    $("#editcommentblock"+commentid).hide();
                    $("#edit_comment"+commentid).show();
                    $("#delcomment"+commentid).show();
                });
            });
            function addreply(commentid) {
                var reply = $('#reply'+commentid).val();
                var postid= {{post.id}};
                if(!reply | $.trim( reply )== '' ){
                    alert('Enter valid reply');
                }
                else{
                    $.get('/blog/add_reply/', {reply:reply, postid: postid, commentid:commentid }, function(data){$("#showreply"+commentid).prepend('</br><div id="reply'+data.newid+'"><a class="pull-left " href="/blog/user_profile/{{post.user_id}}">{% if profile.profile_picture %}<img class="media-object img-text" src="/media/{{profile.profile_picture}}" style="width:50px; height:50px; " alt="{{user.username}}" width="64">{% else %}<img class="media-object img-text" src="/media/user/no-image.jpg" style="width:50px; height:50px; " alt="{{user.username}}" width="64">{% endif %}</a><div class="media-body"><h6 class="media-heading"><a href="/blog/user_profile/{{user.id}}">{% if user.first_name or user.last_name %}{{user.first_name}} {{user.last_name}}{% else %} {{user.username}}{%endif%}</a> <a class="show-comments" onClick="editreply('+data.newid+')" style="font-size:10px; display:inline;">(Edit)</a><li class="xn-icon-button pull-right"><a onClick="deletereply('+data.newid+')" title="Remove Reply"><span class="fa fa-remove"></a></span></li></h6><p style="word-break:break-all;">'+data.reply+'</p><br></div></div>').fadeIn("slow");
                        $("#reply"+commentid).val("");
                    });
                }
            }

            function editcommentbutton(commentid) {
                $("#comment_data"+commentid).hide();
                $("#comment_created_on"+commentid).hide();
                $("#editcommentblock"+commentid).show();
                $("#edit_comment"+commentid).hide();
                $("#delcomment"+commentid).hide();

            }

            function editreplybutton(commentid) {
                $.get('/blog/edit_comment/', {commentid:commentid }, function(data){

                });
            }

            function deletecomment(commentid){
                    $.get('/blog/delete_comment/', {commentid: commentid}, function(data){
                        $("#comment"+data).hide();
                    });
                }

            function deletereply(replyid){
                    $.get('/blog/delete_reply/', {replyid: replyid}, function(data){
                        $("#reply"+data).hide();
                    });
                }

        </script>
{% endblock %}
{% block body %}

    <div class="col-md-8" style="word-wrap:break-word;">
        <div class="panel panel-default">
            <div class="panel-body posts">
                <div class="row">
                    <div class="col-md-12" style="word-wrap:break-word;">
                        <div class="post-item">  
                            <div class="post-title">
                                {{ post.title }} <a href="/blog/edit_post/{{post.id}}"  class="mb-control" data-box="#mb-edit" title="Edit Post"><span class="fa fa-pencil"></span></a>
                                {% if auther %}
                                    <div class="xn-icon-button pull-right">
                                        <a href="/blog/delete_post/{{post.id}}"  class="mb-control" data-box="#mb-delete" title="Delete Post"><span class="fa fa-remove"></span></a>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="post-date"><span class="fa fa-calendar"></span> {{post.created_on}} / <a href="/blog/user_profile/{{post.user_id}}">by {{post.user}}</a>  <a href="/blog/category/{{post.category}}">in {{post.category}} Category</a></div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    {%if post.thumb %}
                                        <img src="/media/{{post.thumb}}" class="img-responsive img-text"/>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <p>{{post.details |safe }}</p>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <h3>See also:</h3>
                                    <ul>
                                        <div class="post-lists">
                                            {% for list in see_also %}
                                                {% if list != post %}
                                                    <li><h5><div><a href="/blog/view_post/{{list.id}}">{{list.title}}</a></div></h5></li>
                                                {% endif %}   
                                            {% endfor %}
                                        </div>
                                    </ul>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <button id="unlike" type="button" class="btn btn-danger" data-postid="{{post.id}}" title="Unlike"><span class="fa fa-heart-o"></span><p id="unlikep" style="display:inline;">{{post.likes}}</p></button>
                                    
                                    <button id ="like" type="button" class="btn" data-postid="{{post.id}}" title="Like"><span class="fa fa-heart"></span><p id="likep" style="display:inline;">{{post.likes}}</p></button>
                                    
                                     - <b title="Post Views"><span class="fa fa-eye"></span> {{post.views}}</b> - 
                                    
                                    <button type="button" class="btn btn-warning" data-postid="{{post.id}}" id="unstar" title="Read Later"><span class="fa fa-star-o "></span><p id="unstarp" style="display:inline;">{{post.stars}}</p></button>
                                    
                                    <button type="button" name="star" class="btn" id="star" data-postid="{{post.id}}" title="Read Later"><span class="fa fa-star"></span><p id="starp" style="display:inline;">{{post.stars}}</p></button>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <h3>Comments:</h3>
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <textarea class="form-control" rows="3" id="comment" placeholder="Add Comment" name="comment"></textarea>
                                        </div>
                                    </div>
                                    <div class="form-group push-up-30">
                                        <div class="col-md-6">
                                            <button class="btn btn-info"  id="addcomment">Post Comment</button><br><br>
                                        </div>
                                    </div>
                                    <div class="panel-body list-group list-group-contacts scroll">
                                        <ul class="media-list">
                                            <div class="Comments" id="commenttext">
                                                    
                                                {% for comments in view_comments %}
                                                    <li class="media" id="comment{{comments.id}}">
                                                        <a class="pull-left " href="/blog/user_profile/{{comments.user_id}}">
                                                            {% if comments.userprofile.profile_picture %}
                                                                <img class="media-object img-text" src="/media/{{comments.userprofile.profile_picture}}" style="width:70px; height:70px; " alt="{{comments.user.username}}" width="64">
                                                            {% else %}
                                                                <img class="media-object img-text" src="/media/user/no-image.jpg" style="width:70px; height:70px; " alt="{{comments.user.username}}" width="64">
                                                            {% endif %}
                                                        </a>
                                                        <div class="media-body">
                                                            <h4 class="media-heading">
                                                                <a href="/blog/user_profile/{{comments.user_id}}">
                                                                    {% if comments.user.first_name or comments.user.last_name %}
                                                                        {{comments.user.first_name}} {{comments.user.last_name}}
                                                                    {% else %}
                                                                        {{comments.user.username}}
                                                                    {% endif %}
                                                                </a>
                                                                {% ifequal comments.user user%}
                                                                    <a class="show-comments" onClick="editcommentbutton({{comments.id}})" style="font-size:12px; display:inline;" id="edit_comment{{comments.id}}">(Edit)</a>
                                                                    <li class="xn-icon-button pull-right" id="delcomment{{comments.id}}">
                                                                        <a onClick="deletecomment({{comments.id}})"><span class="fa fa-remove" title="Remove Comment"></span></a>
                                                                    </li>
                                                                {% else %}
                                                                    {% if auther %}
                                                                        <li class="xn-icon-button pull-right"><a onClick="deletecomment({{comments.id}})"><span class="fa fa-remove" title="Remove Comment"></a></span></li>
                                                                        {% endif %}
                                                                {% endifequal %}
                                                            </h4>
                                                            <p style="word-break:break-all;" id="comment_data{{comments.id}}">{{comments.comment}}</p>
                                                            <p id="comment_created_on{{comments.id}}" >{{comments.created_on}}</p><br>
                                                            <div id="editcommentblock{{comments.id}}" style="display:none;">
                                                                    <div class="col-md-12">
                                                                        <textarea class="form-control" rows="3" id="editedcomment{{comments.id}}"  name="comment">{{comments.comment}}</textarea>
                                                                    </div>
                                                                    <div class="col-md-3 col-sm-3 col-xs-12">
                                                                        <br><button class="editcomment btn btn-info" data-commentid="{{comments.id}}">Edit Comment</button>
                                                                    </div>
                                                                    <div class="col-md-9 col-sm-9 col-xs-12">
                                                                        <br><button class="canceleditcomment btn btn-info" data-commentid="{{comments.id}}">Cancel</button><br><br><br>
                                                                    </div>
                                                                        
                                                                
                                                            </div>
                                                            
                                                            <div class="form-group" id="replyblock">
                                                                <div class="col-md-2 col-sm-2 col-xs-4">
                                                                    {% if profile.profile_picture %}
                                                                        <img alt="{{user.username}}" class="img UFIActorImage _54ru img pull-left" src="/media/{{profile.profile_picture}}" style="width:50px; height:50px;" width="64" >
                                                                    {% else %}
                                                                        <img alt="{{user.username}}" class="img UFIActorImage _54ru img pull-left" src="/media/user/no-image.jpg" style="width:50px; height:50px;" width="64" >
                                                                    {% endif %}
                                                                </div>
                                                                <div class="col-md-10 col-sm-6 col-xs-8">
                                                                    <textarea class="form-control" rows="1" placeholder="Add Reply" value="{{reply}}" id="reply{{comments.id}}" name="reply" required></textarea>
                                                                </div>
                                                                <div class="col-md-10 col-sm-10 col-xs-12">
                                                                    <br>
                                                                    <button class="btn btn-info btn-xs" id="addreply" onClick="addreply({{comments.id}})"><span class="fa fa-reply">Reply</span></button>
                                                                </div>
                                                            </div></br></br>
                                                            <br><br><div id="showreply{{comments.id}}">
                                                            </div>
                                                            {% for reply in replies %}
                                                                <div id="reply{{reply.id}}">
                                                                    {% ifequal reply.comment comments %}
                                                                        <a class="pull-left " href="/blog/user_profile/{{post.user_id}}">
                                                                            {% if reply.userprofile.profile_picture %}
                                                                                <img class="media-object img-text" src="/media/{{reply.userprofile.profile_picture}}" style="width:50px; height:50px; " alt="{{reply.user.username}}" width="64">
                                                                            {% else %}
                                                                                <img class="media-object img-text" src="/media/user/no-image.jpg" style="width:50px; height:50px; " alt="{{reply.user.username}}" width="64">
                                                                            {% endif %}
                                                                        </a>
                                                                        <div class="media-body">
                                                                            <h6 class="media-heading">
                                                                                <a href="/blog/user_profile/{{reply.user_id}}">
                                                                                    {% if reply.user.first_name or reply.user.last_name %}
                                                                                        {{reply.user.first_name}} {{reply.user.last_name}}
                                                                                    {% else %}
                                                                                        {{reply.user.username}}
                                                                                    {% endif %}
                                                                                </a>
                                                                                {% ifequal reply.user user%}
                                                                                    <a onClick="editreply({{reply.id}})" style="font-size:10px; display:inline;"> (Edit)</a> 
                                                                                    <li class="xn-icon-button pull-right" id="reply{{reply.id}}">
                                                                                        <a onClick="deletereply({{reply.id}})"><span class="fa fa-remove" title="Remove Reply"></span></a>
                                                                                    </li>
                                                                                {% else %}
                                                                                    {% if auther %}
                                                                                        <li class="xn-icon-button pull-right" id="reply{{reply.id}}">
                                                                                            <a onClick="deletereply({{reply.id}})" title="Remove Reply"><span class="fa fa-remove"></span></a>
                                                                                        </li>
                                                                                        {% endif %}
                                                                                {% endifequal %}
                                                                            </h6>
                                                                            <p  style="word-break:break-all;">{{reply.reply}}</p>
                                                                            <p>{{reply.created_on}}</p><br>
                                                                        </div>
                                                                    {% endifequal %}
                                                                </div>
                                                            {% endfor %}
                                                        </div>
                                                    </li><br><br>
                                                {% endfor %}
                                            </div>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="message-box animated fadeIn" data-sound="alert" id="mb-delete">
        <div class="mb-container">
            <div class="mb-middle">
                <div class="mb-title"><span class="fa fa-remove"></span><strong>Delete The Post?</strong></div>
                <div class="mb-content">
                    <p>Are you sure you want to delete this post permanently?</p>                    
                    <p>Press No if you don't want to delete post. Press Yes to delete this post.</p>
                </div>
                <div class="mb-footer">
                    <div class="pull-right">
                        <a href="/blog/delete_post/{{post.id}}" class="btn btn-danger btn-dl">Delete</a>
                        <button class="btn btn-default btn-lg mb-control-close">No</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


{% endblock %}



