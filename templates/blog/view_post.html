{% extends 'blog.html' %}
{% load staticfiles %}
{% block address %}
    <li><a href="/blog/">Posts</a></li>
    <li><a href="/blog/view_post/{{post.id}}">{{post.title}}</a></li>
{% endblock %}

{% block style %}
            img { 
                width:100%; 
            }
        
{% endblock %}
{% block head %}
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            
            {% if post_data.like == 1 %}
                $("#like").hide()
            {% else %}
                $("#unlike").hide()
            {% endif %}

            {% if post_data.star == 1 %}
                $("#star").hide()
            {% else %}
                $("#unstar").hide()
            {% endif %}

            $('#unlike').click(function(){
                var postid;
                postid = $(this).attr("data-postid");
                $.get('/blog/unlike_post/', {postid: postid}, function(data){
                    $("#unlike").hide();
                    $("#like").show();        
                    $("#likep").text(data);
                    
                });
            });

            $('#like').click(function(){
                var postid;
                postid = $(this).attr("data-postid");
                $.get('/blog/like_post/', {postid: postid}, function(data){
                    $("#unlike").show();
                    $("#unlikep").text(data);
                    $("#like").hide();
                });
            });

            $('#unstar').click(function(){
                var postid;
                postid = $(this).attr("data-postid");
                $.get('/blog/unstar_post/', {postid: postid}, function(data){
                    $("#unstar").hide();
                    $("#star").show();        
                    $("#starp").text(data);
                    
                });
            });

            $('#star').click(function(){
                var postid;
                postid = $(this).attr("data-postid");
                $.get('/blog/star_post/', {postid: postid}, function(data){
                    $("#star").hide();
                    $("#unstar").show();        
                    $("#unstarp").text(data);
                    
                });
            });

            $("#addcomment").click(function() {
                var comment = $('#comment').val();
                var postid= {{post.id}};
                if(!comment | $.trim( $('#comment').val() ) == '' ){
                    alert('Enter valid comment');
                }
                else{
                    $.get('/blog/post_comment/', {comment:comment, postid: postid}, function(data){
                        $("#commenttext").prepend('<li class="media"><a class="pull-left" href="/blog/user_profile/{{user.id}}">{% if profile.profile_picture %}<img class="media-object img-text" src="/media/{{profile.profile_picture}}" style="width:70px; height:70px; " alt="{{user.username}}" width="64">{% else %}<img class="media-object img-text" src="/media/user/no-image.jpg" style="width:70px; height:70px; " alt="{{user.username}}" width="64">{% endif %}</a><div class="media-body"><h4 class="media-heading"><a href="/blog/user_profile/{{user.id}}">{{user.first_name}} {{user.last_name}}</a><li class="xn-icon-button pull-right"><a href="/blog/delete_comment/{{post.id}}-'+data.newid+'" id="link"><span class="fa fa-remove"></a></span></h4><p style="word-break:break-all;">'+data.comment+'</p></div></li>')
                        $("#comment").val("");
                    });
                }
            });
            
        });
        function add(commentid) {
                var reply = $('#reply'+commentid).val();
                var postid= {{post.id}};
                if(!reply | $.trim( reply )== '' ){
                    alert('Enter valid reply');
                }else{
                    $.get('/blog/add_reply/', {reply:reply, postid: postid, commentid:commentid }, function(data){
                        $("#showreply"+commentid).prepend('<a class="pull-left " href="/blog/user_profile/{{user.id}}"><img class="media-object img-text" src="/media/{{profile.profile_picture}}" style="width:50px; height:50px; " alt="{{user.username}}" width="64"></a><div class="media-body"><h6 class="media-heading"><a href="/blog/user_profile/{{user.id}}">{{user.first_name}} {{user.last_name}}</a><li class="xn-icon-button pull-right"><a href="/blog/delete_reply/{{post.id}}-'+data.newid+'"><span class="fa fa-remove"></a></span></h6><p style="word-break:break-all;">'+data.reply+'"</p><br></div>')
                        $("#reply"+commentid).val("");
                    });
                }
            }
    </script>
{% endblock %}
{% block body %}

    <div class="col-md-8" style="word-wrap:break-word;">
        <div class="panel panel-default">
            <div class="panel-body posts">
                <div class="row">
                    <div class="col-md-12" style="word-wrap:break-word;">
                        <div class="post-item">  
                            <div class="post-title">
                                {{ post.title }} <a href="/blog/edit_post/{{post.id}}"  class="mb-control" data-box="#mb-edit" title="Edit Post"><span class="fa fa-pencil"></a></span>
                                {% if auther %}
                                    <div class="xn-icon-button pull-right">
                                        <a href="/blog/delete_post/{{post.id}}"  class="mb-control" data-box="#mb-delete" title="Delete Post"><span class="fa fa-remove"></a></span>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="post-date"><span class="fa fa-calendar"></span> {{post.created_on}} / <a href="/blog/user_profile/{{post.user_id}}">by {{post.user}}</a>  <a href="/blog/category/{{post.category}}">in {{post.category}} Category</a></div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    {%if post.thumb %}
                                        <img src="/media/{{post.thumb}}" class="img-responsive img-text"/>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <p>{{post.details |safe }}</p>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <h3>See also:</h3>
                                    <ul>
                                        <div class="post-lists">
                                            {% for list in see_also %}
                                                {% if list != post %}
                                                    <li><h5><div><a href="/blog/view_post/{{list.id}}">{{list.title}}</a></div></h5></li>
                                                {% endif %}   
                                            {% endfor %}
                                        </div>
                                    </ul>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <button id="unlike" type="button" class="btn btn-danger" data-postid="{{post.id}}" title="Unlike"><span class="fa fa-heart-o"></span><p id="unlikep" style="display:inline;">{{post.likes}}</p></button>
                                    
                                    <button id ="like" type="button" class="btn" data-postid="{{post.id}}" title="Like"><span class="fa fa-heart"></span><p id="likep" style="display:inline;">{{post.likes}}</p></button>
                                    
                                     - <b><span class="fa fa-eye"></span> {{post.views}}</b> - 
                                    
                                    <button type="button" class="btn btn-warning" data-postid="{{post.id}}" id="unstar" title="Read Later"><span class="fa fa-star-o "></span><p id="unstarp" style="display:inline;">{{post.stars}}</p></button>
                                    
                                    <button type="button" name="star" class="btn" id="star" data-postid="{{post.id}}" title="Read Later"><span class="fa fa-star"></span><p id="starp" style="display:inline;">{{post.stars}}</p></button>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <h3>Comments:</h3>
                                        <div class="form-group">
                                            <div class="col-md-12">
                                                <textarea class="form-control" rows="3" id="comment" placeholder="Add Comment" name="comment"></textarea>
                                            </div>
                                        </div>
                                        <div class="form-group push-up-30">
                                            <div class="col-md-6">
                                                <button class="btn btn-info"  id="addcomment">Post Comment</button><br><br>
                                            </div>
                                        </div>
                                   <div class="panel-body list-group list-group-contacts scroll">
                                        <ul class="media-list">
                                            <div class="Comments" id="commenttext">
                                                    
                                                {% for comments in view_comments %}
                                                    <li class="media">
                                                        <a class="pull-left " href="/blog/user_profile/{{comments.user_id}}">
                                                            {% if comments.userprofile.profile_picture %}
                                                                <img class="media-object img-text" src="/media/{{comments.userprofile.profile_picture}}" style="width:70px; height:70px; " alt="{{comments.user.username}}" width="64">
                                                            {% else %}
                                                                <img class="media-object img-text" src="/media/user/no-image.jpg" style="width:70px; height:70px; " alt="{{comments.user.username}}" width="64">
                                                            {% endif %}
                                                        </a>
                                                        <div class="media-body">
                                                            <h4 class="media-heading">
                                                                <a href="/blog/user_profile/{{comments.user_id}}">{{comments.user.first_name}} {{comments.user.last_name}}</a>
                                                                {% ifequal comments.user user%}
                                                                    <li class="xn-icon-button pull-right"><a href="/blog/delete_comment/{{post.id}}-{{comments.id}}"><span class="fa fa-remove"></a></span>
                                                                {% else %}
                                                                    {% if auther %}
                                                                        <li class="xn-icon-button pull-right"><a href="/blog/delete_comment/{{post.id}}-{{comments.id}}"><span class="fa fa-remove"></a></span>
                                                                        {% endif %}
                                                                {% endifequal %}
                                                            </h4>
                                                            <p style="word-break:break-all;">{{comments.comment}}</p>
                                                            <p>{{comments.created_on}}</p><br>
                                                            <div class="form-group">
                                                                <div class="col-md-2 col-sm-2 col-xs-4">
                                                                    {% if profile.profile_picture %}
                                                                        <img alt="{{user.username}}" class="img UFIActorImage _54ru img pull-left" src="/media/{{profile.profile_picture}}" style="width:50px; height:50px;" width="64" >
                                                                    {% else %}
                                                                        <img alt="{{user.username}}" class="img UFIActorImage _54ru img pull-left" src="/media/user/no-image.jpg" style="width:50px; height:50px;" width="64" >
                                                                    {% endif %}
                                                                </div>
                                                                <div class="col-md-10 col-sm-6 col-xs-8">
                                                                    <textarea class="form-control" rows="1" placeholder="Add Reply" value="{{reply}}" id="reply{{comments.id}}" name="reply" required></textarea>
                                                                    
                                                                </div>
                                                                <div class="col-md-2 col-sm-4">
                                                                    <button class="btn btn-info btn-xs" id="addreply" onClick="add({{comments.id}})"><span class="fa fa-reply">Reply</span></button>
                                                                </div>
                                                            </div><br><br><br>
                                                            <div id="showreply{{comments.id}}">
                                                            </div>
                                                            {% for reply in replies %}
                                                                {% ifequal reply.comment comments %}
                                                                    <a class="pull-left " href="/blog/user_profile/{{post.user_id}}">
                                                                        {% if reply.userprofile.profile_picture %}
                                                                            <img class="media-object img-text" src="/media/{{reply.userprofile.profile_picture}}" style="width:50px; height:50px; " alt="{{reply.user.username}}" width="64">
                                                                        {% else %}
                                                                            <img class="media-object img-text" src="/media/user/no-image.jpg" style="width:50px; height:50px; " alt="{{reply.user.username}}" width="64">
                                                                        {% endif %}
                                                                    </a>
                                                                    <div class="media-body">
                                                                        <h6 class="media-heading">
                                                                            <a href="/blog/user_profile/{{reply.user_id}}">{{reply.user.first_name}} {{reply.user.last_name}}</a>
                                                                            {% ifequal reply.user user%}
                                                                                <li class="xn-icon-button pull-right"><a href="/blog/delete_reply/{{post.id}}-{{reply.id}}"><span class="fa fa-remove"></a></span>
                                                                            {% else %}
                                                                                {% if auther %}
                                                                                    <li class="xn-icon-button pull-right"><a href="/blog/delete_reply/{{post.id}}-{{reply.id}}"><span class="fa fa-remove"></a></span>
                                                                                    {% endif %}
                                                                            {% endifequal %}
                                                                        </h6>
                                                                        <p  style="word-break:break-all;">{{reply.reply}}<br>
                                                                        {{reply.created_on}}</p><br>
                                                                    </div>
                                                                {% endifequal %}
                                                            {% endfor %}
                                                        </div>
                                                    </li><br><br>
                                                {% endfor %}
                                            </div>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="message-box animated fadeIn" data-sound="alert" id="mb-delete">
        <div class="mb-container">
            <div class="mb-middle">
                <div class="mb-title"><span class="fa fa-remove"></span><strong>Delete The Post?</strong></div>
                <div class="mb-content">
                    <p>Are you sure you want to delete this post permanently?</p>                    
                    <p>Press No if you don't want to delete post. Press Yes to delete this post.</p>
                </div>
                <div class="mb-footer">
                    <div class="pull-right">
                        <a href="/blog/delete_post/{{post.id}}" class="btn btn-danger btn-dl">Delete</a>
                        <button class="btn btn-default btn-lg mb-control-close">No</button>
                    </div>
                </div>
            </div>
        </div>
    </div>



    

{% endblock %}



