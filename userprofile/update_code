from django.http import HttpResponse, HttpResponseRedirect
from django.template import RequestContext
from django.shortcuts import render_to_response, render
from django.contrib.auth import authenticate, login, logout
from django.contrib.auth.decorators import login_required
from userprofile.models import UserProfile
from .forms import UserProfileForm, EditProfileForm
from django.contrib.auth.models import User
# from blog.bing_search import run_query
from django.contrib import messages

# Create your views here.

@login_required(login_url='/login/')
def update_profile(request):
    username=request.user.username
    user=User.objects.get(username=username)
    try:
        profile=UserProfile.objects.get(user_id=user.id)
    except:
        profile=UserProfile()
    form = EditProfileForm(request.POST)
    profile_form = UserProfileForm(request.POST, request.FILES)
    if request.method == 'POST':
        profile.user_id=user.id
        if form.is_valid() and profile_form.is_valid():
            user.first_name = request.POST['first_name']
            user.last_name = request.POST['last_name']
            user.email = request.POST['email']

            profile.designation = request.POST['designation']
            profile.birthdate = request.POST['birthdate']
            profile.lives_in = request.POST['lives_in']
            # profile.profile_picture = request.POST['profile_picture']
            # print profile.designation

            user.save()
            profile.save()
            

    context = {
        "form": form,
        "profile_form": profile_form
    }

    return render(request, "userprofile/update.html", context)

def user_profile(request):
    username=request.user.username
    user=User.objects.get(username=username)
    try:
        profile=UserProfile.objects.get(user_id=user.id)
    except:
        profile=UserProfile()
    return render(request, 'userprofile/profile.html', {'profile': profile})













{% extends "profile.html" %}
{% load staticfiles %}
{% block address %}
<li><a href="/blog/edit_profile/">Edit Profile</a></li>
{% endblock %}
{% block body %}
<div>
<form method="post" action="" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}
    {{ profile_form.as_p }}

    <input type="submit" value="Update Profile" />
</form>
</div>
{% endblock %}


    