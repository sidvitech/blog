{% load custom_tags %}
<!DOCTYPE html>
<html>
<head>
	<title>Post Details</title>
	<h1>Post Details</h1>
	<hr/>
</head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script type='text/javascript'>
	$('input[type="text"]').addClass('form-control');
	$('textarea').addClass('form-control');
</script>

<body>
		{% if posts %}
			
			{% for post in posts %}
			<ul>
			<h2 style="color:orange;"><i><b>{{post.postname}}</b></i></h2>
			<li><h4 style="color:green;"><u>Blog Title</u> : {{post.blogname}}</h4></li>
			<li><h4 style="color:green;"><u>Text </u>: <div id='h{{ post.pk }}'>{{ post.text|safe }}</div></h4></li>
			<li><h4 style="color:green;"><u>Image</u> :
			{% if post.picture %}
				<img src="{{ post.picture.url }}" height="200" width="200" border="1"/>
			{% else %}
				No image uploaded	
			{% endif %}	</h4></li>
			<li><h4 style="color:green;"><u>Video</u> :
			{% if post.video %}
				<video width="400" controls>
				  <source src="{{ post.video.url }}" type="video/mp4">
				  Your browser does not support HTML5 video.
				</video>
			{% else %}
				<h4 style="color:green;">No video uploaded</h4>	
			{% endif %}	</h4></li>
			<li><h4 style="color:green;"><u>Visibility </u>: {{post.visibility}}</h4></li>
			</ul>
			<h3 style="color:orange;">Comments on post (<small>{{ post.postname|comment_count}}</small>)</h3>
			<div>
				{% for comment in post.postname|get_post %}
				<ul>
					<h4 style="color:violet;"><li><i><u>{{ comment.user.get_full_name }}</u></i> : {{ comment.comment }}</li></h4>
					
				</ul>
				<form action="" method="post" >{% csrf_token %}
				{{user_form.as_p}}
				<input type="hidden" name="postname" value="{{ post.postname }}">
				<input type="hidden" name="oldcomment" value="{{ comment.comment }}">
				<button type ="submit">Edit Comment</button>
				</form>
				{% endfor %}
			</div>
			
			<h3 style="color:orange;">Add comment on post</h3>
			
			
			<form action="" method="post" enctype="multipart/form-data">{% csrf_token %}
			{{form.as_p}}
			<input type="hidden" name="postname" value="{{ post.postname }}">
			<input type='submit' value='Comment' class='btn btn-primary btn-lg btn-block'/>
			</form>
			

			<hr/>
			<script type="text/javascript">
		    $(function(){
		        var txt= $('#h{{ post.pk }}').text();
		        
		        if(txt.length > 55){
		    		$("#h{{ post.pk }}").html(txt.substring(0,50) + '<p id="p{{ post.pk }}">...</p>');
		        }
		    });
		    
			</script>
			<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
			<script>
			$(document).ready(function(){
				$('#p{{ post.pk }}').click(function(){
		    	// alert("hello");
		    	$('#h{{ post.pk }}').text("{{ post.text|safe }}").toString();
		    });
			});
			</script>
			{% endfor %}
		{% endif %}



		
		<h2>comments on post</h2>	
		{% if comments %}
			{% for comment in comments %}
				<ul>
				<li><h3 style="color:blue;"><i>{{comment.postname}}</i></h3></li>
				<li><h4 style="color:blue;"><i>{{comment.comment}}</i></h4></li>
				</ul>
			{% endfor %}
		{% endif %}		

		
	
</body>
</html>